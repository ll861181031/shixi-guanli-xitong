import{_ as ae,r as u,u as te,i as oe,a as se,A as ne,c as V,b as a,w as s,d as r,B as S,E as x,C as re,o as i,D as ue,k as c,g,y as A,H as L,I as P,l as z,h as B}from"./index-BwUFaNKW.js";const de={class:"users"},ie={class:"header-actions"},pe={class:"header-right"},me={key:1},_e={__name:"Users",setup(fe){const y=u(!1),w=u(!1),D=u([]),U=u(1),h=u(10),R=u(0),k=u("student"),f=u(!1),T=u("新增用户"),v=u(null),I=te(),M=oe(()=>{var o;return((o=I.user)==null?void 0:o.role)==="admin"}),q=[{label:"岗位管理",value:"positions"},{label:"申请管理",value:"applications"},{label:"签到管理",value:"checkins"},{label:"周报管理",value:"reports"},{label:"数据统计",value:"statistics"},{label:"用户管理",value:"users"}],H=q.reduce((o,e)=>(o[e.value]=e.label,o),{}),l=se({username:"",real_name:"",role:"student",student_id:"",phone:"",email:"",password:"",permissions:[]}),O={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],student_id:[{validator:(o,e,n)=>{l.role==="student"&&!e?n(new Error("学生需要填写学号")):n()},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};function $(o){return{admin:"管理员",teacher:"教师",student:"学生"}[o]||o}function j(o){return H[o]||o}function G(){var o;l.username="",l.real_name="",l.role="student",l.student_id="",l.phone="",l.email="",l.password="",l.permissions=[],(o=v.value)==null||o.clearValidate()}function J(){G(),f.value=!0}function K(){var o;l.role!=="student"&&(l.student_id=""),l.role!=="teacher"&&(l.permissions=[]),(o=v.value)==null||o.validateField("student_id")}async function b(){y.value=!0;try{const o=await S.get("/users",{params:{page:U.value,per_page:h.value,role:k.value}});o.data.success&&(D.value=o.data.data.items,R.value=o.data.data.total)}catch{x.error("获取用户列表失败")}finally{y.value=!1}}async function Q(){v.value&&await v.value.validate(async o=>{var e,n;if(o){w.value=!0;try{const d={username:l.username,real_name:l.real_name,role:l.role,phone:l.phone||void 0,email:l.email||void 0,password:l.password};l.role==="student"&&(d.student_id=l.student_id),l.role==="teacher"&&(d.permissions=l.permissions),await S.post("/users",d),x.success("新增用户成功"),f.value=!1,b()}catch(d){x.error(((n=(e=d.response)==null?void 0:e.data)==null?void 0:n.message)||"新增用户失败")}finally{w.value=!1}}})}return ne(()=>{b()}),(o,e)=>{const n=r("el-option"),d=r("el-select"),C=r("el-button"),m=r("el-table-column"),E=r("el-tag"),W=r("el-table"),X=r("el-pagination"),_=r("el-input"),p=r("el-form-item"),Y=r("el-form"),Z=r("el-dialog"),ee=r("el-card"),le=re("loading");return i(),V("div",de,[a(ee,null,{header:s(()=>[B("div",ie,[e[14]||(e[14]=B("span",null,"用户管理",-1)),B("div",pe,[a(d,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),size:"small",onChange:b},{default:s(()=>[a(n,{label:"学生",value:"student"}),a(n,{label:"教师",value:"teacher"}),a(n,{label:"管理员",value:"admin"}),a(n,{label:"全部",value:"all"})]),_:1},8,["modelValue"]),M.value?(i(),c(C,{key:0,type:"primary",size:"small",style:{"margin-left":"10px"},onClick:J},{default:s(()=>[...e[13]||(e[13]=[g(" 新增用户 ",-1)])]),_:1})):z("",!0)])])]),default:s(()=>[ue((i(),c(W,{data:D.value,border:""},{default:s(()=>[a(m,{prop:"username",label:"用户名"}),a(m,{prop:"real_name",label:"真实姓名"}),a(m,{prop:"student_id",label:"学号"}),a(m,{prop:"role",label:"角色"},{default:s(({row:t})=>[a(E,{type:t.role==="admin"?"danger":t.role==="teacher"?"warning":"success"},{default:s(()=>[g(A($(t.role)),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"permissions",label:"权限",width:"260"},{default:s(({row:t})=>{var F;return[(F=t.permissions)!=null&&F.length?(i(!0),V(L,{key:0},P(t.permissions,N=>(i(),c(E,{key:N,size:"small",type:"info",style:{margin:"2px"}},{default:s(()=>[g(A(j(N)),1)]),_:2},1024))),128)):(i(),V("span",me,"--"))]}),_:1}),a(m,{prop:"credit_score",label:"信用分",width:"90"}),a(m,{prop:"created_at",label:"创建时间"})]),_:1},8,["data"])),[[le,y.value]]),a(X,{"current-page":U.value,"onUpdate:currentPage":e[1]||(e[1]=t=>U.value=t),"page-size":h.value,"onUpdate:pageSize":e[2]||(e[2]=t=>h.value=t),total:R.value,layout:"total, prev, pager, next",onCurrentChange:b,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"]),a(Z,{modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=t=>f.value=t),title:T.value,width:"520px"},{footer:s(()=>[a(C,{onClick:e[11]||(e[11]=t=>f.value=!1)},{default:s(()=>[...e[15]||(e[15]=[g("取消",-1)])]),_:1}),a(C,{type:"primary",loading:w.value,onClick:Q},{default:s(()=>[...e[16]||(e[16]=[g("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(Y,{ref_key:"formRef",ref:v,model:l,rules:O,"label-width":"90px"},{default:s(()=>[a(p,{label:"用户名",prop:"username"},{default:s(()=>[a(_,{modelValue:l.username,"onUpdate:modelValue":e[3]||(e[3]=t=>l.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(p,{label:"真实姓名",prop:"real_name"},{default:s(()=>[a(_,{modelValue:l.real_name,"onUpdate:modelValue":e[4]||(e[4]=t=>l.real_name=t),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),a(p,{label:"角色",prop:"role"},{default:s(()=>[a(d,{modelValue:l.role,"onUpdate:modelValue":e[5]||(e[5]=t=>l.role=t),onChange:K},{default:s(()=>[a(n,{label:"学生",value:"student"}),a(n,{label:"教师",value:"teacher"}),a(n,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),l.role==="student"?(i(),c(p,{key:0,label:"学号",prop:"student_id"},{default:s(()=>[a(_,{modelValue:l.student_id,"onUpdate:modelValue":e[6]||(e[6]=t=>l.student_id=t),placeholder:"请输入学号"},null,8,["modelValue"])]),_:1})):z("",!0),a(p,{label:"手机号"},{default:s(()=>[a(_,{modelValue:l.phone,"onUpdate:modelValue":e[7]||(e[7]=t=>l.phone=t),placeholder:"可选：请输入手机号"},null,8,["modelValue"])]),_:1}),a(p,{label:"邮箱"},{default:s(()=>[a(_,{modelValue:l.email,"onUpdate:modelValue":e[8]||(e[8]=t=>l.email=t),placeholder:"可选：请输入邮箱"},null,8,["modelValue"])]),_:1}),a(p,{label:"密码",prop:"password"},{default:s(()=>[a(_,{modelValue:l.password,"onUpdate:modelValue":e[9]||(e[9]=t=>l.password=t),type:"password",placeholder:"默认密码"},null,8,["modelValue"])]),_:1}),l.role==="teacher"?(i(),c(p,{key:1,label:"权限",prop:"permissions"},{default:s(()=>[a(d,{modelValue:l.permissions,"onUpdate:modelValue":e[10]||(e[10]=t=>l.permissions=t),multiple:"",placeholder:"请选择可访问模块"},{default:s(()=>[(i(),V(L,null,P(q,t=>a(n,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})])}}},ce=ae(_e,[["__scopeId","data-v-c1118a4e"]]);export{ce as default};
