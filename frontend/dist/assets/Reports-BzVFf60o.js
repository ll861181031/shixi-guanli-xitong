import{r as p,a as K,A as L,c as O,b as l,w as e,d as n,B as D,E as C,C as Q,o as s,D as W,k as i,g as r,y as m,l as _,h as U}from"./index-BwUFaNKW.js";const X={class:"reports"},h={__name:"Reports",setup(Y){const y=p(!1),z=p([]),k=p(1),w=p(10),B=p(0),v=p(!1),V=p("周报详情"),o=p(null),d=K({score:0,comment:""});function N(u){return u?`/api/uploads/${u}`:""}async function x(){y.value=!0;try{const u=await D.get("/weekly-reports",{params:{page:k.value,per_page:w.value}});u.data.success&&(z.value=u.data.data.items,B.value=u.data.data.total)}catch{C.error("获取周报列表失败")}finally{y.value=!1}}function E(u){o.value={...u},V.value="周报详情",v.value=!0}function A(u){o.value={...u},d.score=0,d.comment="",V.value="批改周报",v.value=!0}async function M(){try{await D.post(`/weekly-reports/${o.value.id}/review`,d),C.success("批改成功"),v.value=!1,x()}catch{C.error("批改失败")}}return L(()=>{x()}),(u,t)=>{const c=n("el-table-column"),P=n("el-tag"),b=n("el-button"),S=n("el-table"),T=n("el-pagination"),F=n("el-card"),g=n("el-descriptions-item"),j=n("el-descriptions"),R=n("el-input"),f=n("el-form-item"),q=n("el-link"),G=n("el-input-number"),H=n("el-form"),I=n("el-dialog"),J=Q("loading");return s(),O("div",X,[l(F,null,{header:e(()=>[...t[7]||(t[7]=[U("span",null,"周报管理",-1)])]),default:e(()=>[W((s(),i(S,{data:z.value,border:""},{default:e(()=>[l(c,{prop:"student_name",label:"学生姓名"}),l(c,{prop:"student_id_number",label:"学号"}),l(c,{prop:"position_title",label:"岗位标题"}),l(c,{prop:"week_number",label:"周次"}),l(c,{prop:"status",label:"状态"},{default:e(({row:a})=>[l(P,{type:a.status==="reviewed"?"success":"warning"},{default:e(()=>[r(m(a.status==="reviewed"?"已批改":"待批改"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"score",label:"评分"}),l(c,{label:"操作",width:"200"},{default:e(({row:a})=>[l(b,{size:"small",onClick:$=>E(a)},{default:e(()=>[...t[8]||(t[8]=[r("查看",-1)])]),_:1},8,["onClick"]),a.status==="submitted"?(s(),i(b,{key:0,size:"small",type:"primary",onClick:$=>A(a)},{default:e(()=>[...t[9]||(t[9]=[r(" 批改 ",-1)])]),_:1},8,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])),[[J,y.value]]),l(T,{"current-page":k.value,"onUpdate:currentPage":t[0]||(t[0]=a=>k.value=a),"page-size":w.value,"onUpdate:pageSize":t[1]||(t[1]=a=>w.value=a),total:B.value,layout:"total, prev, pager, next",onCurrentChange:x,style:{"margin-top":"20px"}},null,8,["current-page","page-size","total"])]),_:1}),l(I,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=a=>v.value=a),title:V.value,width:"700px"},{footer:e(()=>{var a;return[l(b,{onClick:t[5]||(t[5]=$=>v.value=!1)},{default:e(()=>[...t[10]||(t[10]=[r("关闭",-1)])]),_:1}),((a=o.value)==null?void 0:a.status)==="submitted"?(s(),i(b,{key:0,type:"primary",onClick:M},{default:e(()=>[...t[11]||(t[11]=[r(" 提交批改 ",-1)])]),_:1})):_("",!0)]}),default:e(()=>[o.value?(s(),i(H,{key:0,model:d,"label-width":"100px"},{default:e(()=>[l(j,{column:2,border:""},{default:e(()=>[l(g,{label:"学生姓名"},{default:e(()=>[r(m(o.value.student_name),1)]),_:1}),l(g,{label:"学号"},{default:e(()=>[r(m(o.value.student_id_number),1)]),_:1}),l(g,{label:"岗位标题"},{default:e(()=>[r(m(o.value.position_title),1)]),_:1}),l(g,{label:"周次"},{default:e(()=>[r(m(o.value.week_number),1)]),_:1})]),_:1}),l(f,{label:"周报内容",style:{"margin-top":"20px"}},{default:e(()=>[l(R,{modelValue:o.value.content,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.content=a),type:"textarea",rows:6,readonly:""},null,8,["modelValue"])]),_:1}),o.value.attachment_name?(s(),i(f,{key:0,label:"附件"},{default:e(()=>[l(q,{href:N(o.value.attachment_path),target:"_blank"},{default:e(()=>[r(m(o.value.attachment_name),1)]),_:1},8,["href"])]),_:1})):_("",!0),o.value.status==="submitted"?(s(),i(f,{key:1,label:"评分"},{default:e(()=>[l(G,{modelValue:d.score,"onUpdate:modelValue":t[3]||(t[3]=a=>d.score=a),min:0,max:100},null,8,["modelValue"])]),_:1})):_("",!0),o.value.status==="submitted"?(s(),i(f,{key:2,label:"批改意见"},{default:e(()=>[l(R,{modelValue:d.comment,"onUpdate:modelValue":t[4]||(t[4]=a=>d.comment=a),type:"textarea",rows:4},null,8,["modelValue"])]),_:1})):_("",!0),o.value.status==="reviewed"?(s(),i(f,{key:3,label:"评分"},{default:e(()=>[U("span",null,m(o.value.score),1)]),_:1})):_("",!0),o.value.status==="reviewed"?(s(),i(f,{key:4,label:"批改意见"},{default:e(()=>[U("span",null,m(o.value.comment),1)]),_:1})):_("",!0)]),_:1},8,["model"])):_("",!0)]),_:1},8,["modelValue","title"])])}}};export{h as default};
