<view class="container">
  <view class="search-bar">
    <input placeholder="æœç´¢å²—ä½" value="{{keyword}}" bindinput="onSearchInput" />
    <button size="mini" bindtap="onSearch">æœç´¢</button>
  </view>

  <view class="filter-panel card">
    <view class="filter-row">
      <view class="filter-label">åœ°ç‚¹</view>
      <picker
        mode="selector"
        range="{{locationOptions}}"
        value="{{selectedLocationIndex}}"
        bindchange="onLocationChange"
      >
        <view class="picker-value">{{locationOptions[selectedLocationIndex]}}</view>
      </picker>
    </view>

    <view class="filter-row salary-row">
      <view class="filter-label">è–ªèµ„èŒƒå›´</view>
      <view class="salary-display">{{filters.minSalary}} - {{filters.maxSalary}} å…ƒ/æœˆ</view>
      <slider
        class="salary-slider"
        show-value
        step="{{salaryConfig.step}}"
        min="{{salaryConfig.min}}"
        max="{{salaryConfig.max}}"
        value="{{filters.minSalary}}"
        bindchange="onMinSalaryChange"
      />
      <slider
        class="salary-slider"
        show-value
        step="{{salaryConfig.step}}"
        min="{{salaryConfig.min}}"
        max="{{salaryConfig.max}}"
        value="{{filters.maxSalary}}"
        bindchange="onMaxSalaryChange"
      />
    </view>

    <view class="filter-row">
      <view class="filter-label">å®ä¹ æ—¶é•¿</view>
      <radio-group
        class="chip-group"
        value="{{filters.internshipDuration}}"
        bindchange="onDurationChange"
      >
        <label
          class="chip {{filters.internshipDuration === item.value ? 'chip-active' : ''}}"
          wx:for="{{durationOptions}}"
          wx:key="value"
        >
          <radio
            value="{{item.value}}"
            checked="{{item.value === filters.internshipDuration}}"
          />
          <text>{{item.label}}</text>
        </label>
      </radio-group>
    </view>

    <view class="filter-row">
      <view class="filter-label">å²—ä½çŠ¶æ€</view>
      <radio-group class="chip-group" value="{{filters.status}}" bindchange="onStatusChange">
        <label
          class="chip {{filters.status === item.value ? 'chip-active' : ''}}"
          wx:for="{{statusOptions}}"
          wx:key="value"
        >
          <radio value="{{item.value}}" checked="{{item.value === filters.status}}" />
          <text>{{item.label}}</text>
        </label>
      </radio-group>
    </view>

    <view class="filter-actions">
      <button size="mini" bindtap="resetFilters">é‡ç½®</button>
      <button size="mini" type="primary" bindtap="applyFilters">ç­›é€‰</button>
    </view>
  </view>

  <view class="result-summary">
    å…±æ‰¾åˆ° <text class="summary-number">{{totalCount}}</text> ä¸ªå²—ä½
  </view>

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>

  <view
    wx:for="{{positions}}"
    wx:key="id"
    class="position-card card"
    data-id="{{item.id}}"
    bindtap="navigateToDetail"
  >
    <view class="title-row">
      <view class="title">{{item.title}}</view>
      <view wx:if="{{item.applied}}" class="applied-tag">å·²ç”³è¯·</view>
    </view>
    <view class="company">{{item.company_name}}</view>
    <view class="location">ğŸ“ {{item.location}}</view>
    <view class="info-row">
      <text>è–ªèµ„ï¼š</text>
      <text>{{item.salaryText}}</text>
    </view>
    <view class="info-row">
      <text>æ—¶é•¿ï¼š</text>
      <text>{{item.durationText}}</text>
    </view>
    <view class="info-row">
      <text>çŠ¶æ€ï¼š</text>
      <text class="status-tag status-{{item.status}}">{{item.statusText}}</text>
    </view>
    <view class="info">
      <text>å·²æ¥æ”¶ï¼š{{item.current_students}}/{{item.max_students}}</text>
    </view>
    <view class="card-actions">
      <button
        size="mini"
        plain
        data-id="{{item.id}}"
        catchtap="navigateToDetail"
      >æŸ¥çœ‹è¯¦æƒ…</button>
      <button
        size="mini"
        type="primary"
        plain
        wx:if="{{item.status === 1 && !item.applied}}"
        data-id="{{item.id}}"
        catchtap="applyPosition"
      >ç«‹å³ç”³è¯·</button>
      <button
        size="mini"
        plain
        disabled
        wx:elif="{{item.applied}}"
      >å·²ç”³è¯·</button>
      <button
        size="mini"
        plain
        disabled
        wx:else
      >æš‚ä¸å¯ç”³è¯·</button>
      <button
        size="mini"
        plain
        data-latitude="{{item.latitude}}"
        data-longitude="{{item.longitude}}"
        data-name="{{item.location}}"
        catchtap="openLocation"
      >åœ°å›¾å¯¼èˆª</button>
    </view>
  </view>

  <view wx:if="{{!loading && positions.length === 0}}" class="empty">æš‚æ— å²—ä½</view>
  <view wx:elif="{{hasMore}}" class="loading-more">
    <text wx:if="{{loadingMore}}">åŠ è½½ä¸­...</text>
    <text wx:else>ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
  </view>
  <view wx:elif="{{!hasMore && positions.length > 0}}" class="loading-more">æ²¡æœ‰æ›´å¤šäº†</view>
</view>

